require('dotenv').config();
const express = require('express');
const twilio = require('twilio');
const app = express();

app.use(express.json());
app.use(express.urlencoded({ extended: true }));

// Twilio credentials
const accountSid = process.env.ACCESS_TOKEN;
const authToken = process.env.VERIFY_TOKEN;
const client = twilio(accountSid, authToken);
const twilioWhatsAppNumber = process.env.WHATSAPP_NUMBER;

// Store user state (in-memory; use a database in production)
const userState = {};

// Sub-schemes for each main scheme
const subSchemes = {
  '1': [
    '1. आश्रमशाळा',
    '2. शिष्यवृत्ती',
    '3. वसतीगृहे / आधार योजना'
  ],
  '2': [], // पायाभूत सुविधा संबंधित योजना has no sub-schemes
  '3': [
    '1. संस्था'
  ],
  '4': [
    '1. महामंडळे'
  ],
  '5': [] // इतर योजना has no sub-schemes
};

// Sub-sub-schemes for each sub-scheme
const subSubSchemes = {
  '1': {
    '1': [
      '1. विमुक्त जाती, भटक्या जमाती व विशेष मागास प्रवर्गासाठीच्या आश्रमशाळा',
      '2. उसतोड कामगारांच्या मुलामुलींसाठी निवासी आश्रमशाळा',
      '3. विद्यानिकेतन शाळा'
    ],
    '2': [
      '1. मॅट्रिकपूर्व शिष्यवृत्ती',
      '2. मॅट्रिकोत्तर शिष्यवृत्ती',
      '3. परदेशात उच्च शिक्षणासाठी शिष्यवृत्ती योजना'
    ],
    '3': [
      '1. राज्यातील इतर मागास प्रवर्ग, विमुक्त जाती, भटक्या जमाती व विशेष मागास प्रवर्ग या प्रवर्गातील विद्यार्थ्यांसाठी जिल्हानिहाय वसतीगृहे',
      '2. ज्ञानज्योती सावित्रीबाई फुले आधार योजना'
    ]
  },
  '3': {
    '1': [
      '1. महात्मा ज्योतिबा फुले संशोधन व प्रशिक्षण संस्था (महाज्योती), नागपूर',
      '2. महाराष्ट्र संशोधन अकादमी व प्रशिक्षण प्रबोधिनी (अमृत)'
    ]
  },
  '4': {
    '1': [
      '1. महाराष्ट्र राज्य इतर मागास वर्गीय वित्त आणि विकास महामंडळ',
      '2. वसंतराव नाईक विमुक्त जाती व भटक्या जमाती विकास महामंडळ'
    ]
  }
};

// Sub-sub-sub-schemes (for deeper levels, e.g., under महाराष्ट्र राज्य इतर मागास वर्गीय वित्त आणि विकास महामंडळ)
const subSubSubSchemes = {
  '4': {
    '1': {
      '1': [
        '1. शामराव पेजे आर्थिक विकास महामंडळ (उपकंपनी)',
        '2. जगदज्योती महात्मा बसवेश्वर आर्थिक विकास महामंडळ (उपकंपनी)',
        '3. संत रोहिदास युवा आर्थिक विकास महामंडळ (उपकंपनी)',
        '4. संत सेनाजी महाराज केशशिल्पी महामंडळ (उपकंपनी)',
        '5. बीज भांडवल कर्ज योजना',
        '6. रु.1,00,000/- टेट कर्ज योजना',
        '7. वैयक्तिक कर्ज व्याज परतावा योजना',
        '8. गट कर्ज व्याज परतावा योजना'
      ],
      '2': [
        '1. पैलवान के. मारुती चर्हाण-वडार आर्थिक विकास महामंडळ (उपकंपनी)',
        '2. राजे उमाजी नाईक जातीय विकास महामंडळ (उपकंपनी)'
      ]
    }
  }
};

// Sub-sub-sub-sub-schemes (for the deepest level, e.g., under पैलवान के. मारुती चर्हाण-वडार आर्थिक विकास महामंडळ)
const subSubSubSubSchemes = {
  '4': {
    '1': {
      '2': {
        '1': [
          '1. २५% बीज भांडवल योजना',
          '2. रु. 1.00 लक्षपर्यंतची धेट कर्ज योजना',
          '3. वैयक्तिक कर्ज व्याज परतावा योजना',
          '4. गट कर्ज व्याज परतावा योजना'
        ],
        '2': [
          '1. २५% बीज भांडवल योजना',
          '2. रु. 1.00 लक्षपर्यंतची धेट कर्ज योजना',
          '3. वैयक्तिक कर्ज व्याज परतावा योजना',
          '4. गट कर्ज व्याज परतावा योजना',
          '5. पात्र शेतकरी उत्पादक गटांना कर्ज'
        ]
      }
    }
  }
};

// Sub-scheme details
const subSchemeDetails = {
  '1': {
    '1': 'लाभ घेणारा प्रवर्ग: इतर मागास वर्ग, विमुक्त जाती, भटक्या जमाती आणि विशेष मागास प्रवर्ग\n\n१. आश्रमशाळा\n   निवासी शाळा ज्या मोफत शिक्षण आणि सुविधा प्रदान करतात.',
    '2': 'लाभ घेणारा प्रवर्ग: इतर मागास वर्ग, विमुक्त जाती, भटक्या जमाती आणि विशेष मागास प्रवर्ग\n\n२. शिष्यवृत्ती\n   विविध स्तरांवर शिक्षणासाठी आर्थिक सहाय्य.',
    '3': 'लाभ घेणारा प्रवर्ग: इतर मागास वर्ग, विमुक्त जाती, भटक्या जमाती आणि विशेष मागास प्रवर्ग\n\n३. वसतीगृहे / आधार योजना\n   इतर मागास वर्ग, विमुक्त जाती, भटक्या जमाती आणि विशेष मागास प्रवर्गातील विद्यार्थ्यांसाठी निवास आणि शिक्षणासाठी सहाय्य.'
  },
  '2': {
    '0': 'लाभ घेणारा प्रवर्ग: सर्वसाधारण\n\nपायाभूत सुविधा संबंधित योजना\n   या योजनांचे तपशील उपलब्ध नाहीत.'
  },
  '3': {
    '1': 'लाभ घेणारा प्रवर्ग: सर्वसाधारण\n\n१. संस्था\n   प्रशिक्षण आणि कौशल्य विकासासाठी संस्था.'
  },
  '4': {
    '1': 'लाभ घेणारा प्रवर्ग: इतर मागास वर्ग, विमुक्त जाती, भटक्या जमाती आणि विशेष मागास प्रवर्ग\n\n१. महामंडळे\n   विकास महामंडळांमार्फत आर्थिक सहाय्य.'
  },
  '5': {
    '0': 'लाभ घेणारा प्रवर्ग: सर्वसाधारण\n\nइतर योजना\n   या योजनांचे तपशील उपलब्ध नाहीत.'
  }
};

// Sub-sub-scheme details
const subSubSchemeDetails = {
  '1': {
    '1': {
      '1': `लाभ घेणारा प्रवर्ग: इतर मागास वर्ग, विमुक्त जाती, भटक्या जमाती आणि विशेष मागास प्रवर्ग\n\n१.१ विमुक्त जाती, भटक्या जमाती व विशेष मागास प्रवर्गासाठीच्या आश्रमशाळा\nमहाराष्ट्रातील विमुक्त जाती आणि भटक्या जमाती तसेच विशेष मागास प्रवर्गातील विद्यार्थ्यांसाठी ५७३० प्राथमिक आश्रमशाळा, २९७ माध्यमिक आश्रमशाळा व १४८ उच्च माध्यमिक आश्रमशाळा चालविल्या जातात. सन १९५३-५४ पासून स्वयंसेवी संस्थांमार्फत अनुदान देऊन या शाळा सुरू करण्यात आल्या आहेत. विद्यार्थ्यांना शासनाकडून मोफत निवास, भोजन, शालेय साहित्य, गणवेश (वर्षातून दोनदा), अंथरुण-पांघरुण, वैद्यकीय सुविधा तसेच खेळ, सांस्कृतिक कार्यक्रम आणि आरोग्य तपासणी यासारख्या सुविधा पुरविल्या जातात. स्वयंसेवी संस्था सोसायटी रजिस्ट्रेशन अँक्ट १८६० आणि मुंबई सार्वजनिक विश्वस्त कायदा १९५० अंतर्गत नोंदणीकृत असावी, आर्थिकदृष्ट्या सक्षम असावी आणि त्यांच्यावर कोणताही गुन्हा सिद्ध झालेला नसावा. विद्यार्थी महाराष्ट्राचा रहिवाशी असावा. दरमहा दरडोई ₹१५०० परिपोषण अनुदान, इमारत भाडे आणि ८-१२% वेतनेतर अनुदान दिले जाते. निपुण भारत योजने अंतर्गत शिक्षकांना प्रशिक्षण देऊन जागतिक दर्जाचे शिक्षण दिले जाते. निवासी आणि अनिवासी विद्यार्थ्यांना शिक्षण उपलब्ध आहे. संपर्क: संबंधित जिल्ह्याचे सहायक संचालक, इतर मागास बहुजन कल्याण विभाग. शासन निर्णय: विभशा-२००२/प्र.क्र.३९/मावक-६, दिनांक १६ ऑक्टोबर २००३.`,
      '2': `लाभ घेणारा प्रवर्ग: उसतोड कामगारांचे मुलगा/मुलगी\n\n१.२ उसतोड कामगारांच्या मुलामुलींसाठी निवासी आश्रमशाळा\nबीड जिल्ह्यातील केज आणि परळी वैजनाथ येथे सन १९९६ पासून दोन प्राथमिक निवासी आश्रमशाळा (इयत्ता १ली ते ७वी) चालविल्या जातात, ज्या २०१०-११ पासून इयत्ता ८वी ते १०वी पर्यंत विस्तारित आहेत. या शाळांमध्ये उसतोड कामगारांच्या मुलांना शिक्षणासोबतच मोफत निवास, भोजन, बिछाना, शालेय साहित्य, वह्या, क्रमिक पुस्तके आणि वैद्यकीय सुविधा पुरविल्या जातात. स्वयंसेवी संस्थांना दरमहा दरडोई ₹१५०० अनुदान (प्राथमिकसाठी ११ महिने, माध्यमिकसाठी १० महिने), १००% वेतन अनुदान, ८-१२% वेतनेतर अनुदान आणि ७५% इमारत भाडे अनुदान दिले जाते. विद्यार्थी महाराष्ट्राचा रहिवाशी आणि उसतोड कामगारांचा मुलगा/मुलगी असावा. संपर्क: सहायक संचालक, बीड, इतर मागास बहुजन कल्याण विभाग. शासन निर्णय: उतोका-१९९५/प्र.क्र.१७७/मावक-६, दिनांक ७ मार्च १९९६; विजाभज-२०१४/प्र.क्र.१९८/विजाभज-२, दिनांक ४ मार्च २०१५.`,
      '3': `लाभ घेणारा प्रवर्ग: इतर मागास वर्ग, विमुक्त जाती, भटक्या जमाती आणि विशेष मागास प्रवर्ग\n\n१.३ विद्यानिकेतन शाळा\nनांदेड जिल्ह्यातील वसंतनगर कोटग्याळ, ता. मुखेड येथे विमुक्त जाती सेवा समितीमार्फत सन १९९६-९७ पासून विद्यानिकेतन शाळा चालविली जाते. सध्या इयत्ता ५वी ते १२वी पर्यंत वर्ग असून ६४० विद्यार्थी शिक्षण घेत आहेत. होतकरु आणि गुणवत्ताप्राप्त विद्यार्थ्यांना प्रोत्साहन आणि उच्च शिक्षणासाठी मार्गदर्शन केले जाते. संपर्क: सहायक संचालक, नांदेड, इतर मागास बहुजन कल्याण विभाग. शासन निर्णय: व्हीएएस/१०९०/प्र.क्र.१३५/मावक-६, दिनांक ६ नोव्हेंबर १९९५.`
    },
    '2': {
      '1': 'लाभ घेणारा प्रवर्ग: इतर मागास वर्ग, विमुक्त जाती, भटक्या जमाती आणि विशेष मागास प्रवर्ग\n\n२.१ मॅट्रिकपूर्व शिष्यवृत्ती\n   इतर मागास वर्ग, विमुक्त जाती, भटक्या जमाती व विशेष मागास प्रवर्गातील विद्यार्थ्यांसाठी प्राथमिक आणि माध्यमिक शिक्षणाला प्रोत्साहन देण्यासाठी मॅट्रिकपूर्व शिष्यवृत्ती योजना राबविली जाते. या योजनेंतर्गत विद्यार्थ्यांना शालेय शुल्क, पुस्तके आणि गणवेशासाठी आर्थिक सहाय्य दिले जाते, ज्यामुळे त्यांचे शिक्षण सुरळीत चालते. पुढील तपशील पान क्रमांक 20-30 वर उपलब्ध आहेत (या दस्तऐवजात समाविष्ट नाही).',
      '2': 'लाभ घेणारा प्रवर्ग: इतर मागास वर्ग, विमुक्त जाती, भटक्या जमाती आणि विशेष मागास प्रवर्ग\n\n२.२ मॅट्रिकोत्तर शिष्यवृत्ती\n   इतर मागास वर्ग, विमुक्त जाती, भटक्या जमाती व विशेष मागास प्रवर्गातील विद्यार्थ्यांसाठी उच्च शिक्षणाला प्रोत्साहन देण्यासाठी मॅट्रिकोत्तर शिष्यवृत्ती योजना राबविली जाते. या योजनेंतर्गत महाविद्यालयीन शिक्षण घेणाऱ्या विद्यार्थ्यांना शुल्क माफी, निवास भत्ता आणि पुस्तकांसाठी आर्थिक सहाय्य मिळते. पुढील तपशील पान क्रमांक 20-30 वर उपलब्ध आहेत (या दस्तऐवजात समाविष्ट नाही).',
      '3': 'लाभ घेणारा प्रवर्ग: इतर मागास वर्ग, विमुक्त जाती, भटक्या जमाती आणि विशेष मागास प्रवर्ग\n\n२.३ परदेशात उच्च शिक्षणासाठी शिष्यवृत्ती योजना\n   इतर मागास वर्ग, विमुक्त जाती, भटक्या जमाती व विशेष मागास प्रवर्गातील गुणवंत विद्यार्थ्यांना परदेशात उच्च शिक्षणासाठी शिष्यवृत्ती प्रदान करण्याची योजना. या योजनेंतर्गत विद्यार्थ्यांना परदेशातील नामांकित विद्यापीठांमध्ये शिक्षण घेण्यासाठी शुल्क, प्रवास खर्च आणि निवासासाठी आर्थिक सहाय्य दिले जाते. पुढील तपशील पान क्रमांक 20-30 वर उपलब्ध आहेत (या दस्तऐवजात समाविष्ट नाही).'
    },
    '3': {
      '1': 'लाभ घेणारा प्रवर्ग: इतर मागास वर्ग, विमुक्त जाती, भटक्या जमाती आणि विशेष मागास प्रवर्ग\n\n३.१ राज्यातील इतर मागास प्रवर्ग, विमुक्त जाती, भटक्या जमाती व विशेष मागास प्रवर्ग या प्रवर्गातील विद्यार्थ्यांसाठी जिल्हानिहाय वसतीगृहे\n   राज्यातील इतर मागास प्रवर्ग, विमुक्त जाती, भटक्या जमाती व विशेष मागास प्रवर्गातील विद्यार्थ्यांसाठी जिल्हानिहाय वसतीगृहे सुरु करण्यात आली आहेत, जिथे मोफत निवास, भोजन आणि शैक्षणिक सुविधा पुरविल्या जातात. या वसतीगृहांमध्ये विद्यार्थ्यांना अभ्यासासाठी शांत वातावरण, ग्रंथालय आणि मार्गदर्शन उपलब्ध आहे. पुढील तपशील पान क्रमांक 39-34 वर उपलब्ध आहेत (या दस्तऐवजात समाविष्ट नाही).',
      '2': 'लाभ घेणारा प्रवर्ग: इतर मागास वर्ग, विमुक्त जाती, भटक्या जमाती आणि विशेष मागास प्रवर्ग\n\n३.२ ज्ञानज्योती सावित्रीबाई फुले आधार योजना\n   इतर मागास वर्ग, विमुक्त जाती, भटक्या जमाती व विशेष मागास प्रवर्गातील मुलींच्या शिक्षणाला आणि स्वावलंबनाला प्रोत्साहन देण्यासाठी आर्थिक सहाय्य प्रदान करणारी योजना. या योजनेंतर्गत मुलींना शालेय साहित्य, शुल्क माफी आणि आर्थिक प्रोत्साहन दिले जाते, ज्यामुळे त्यांच्या शिक्षणातील अडचणी दूर होतात आणि त्यांना स्वतःच्या पायावर उभे राहण्यास मदत मिळते. पुढील तपशील पान क्रमांक 39-34 वर उपलब्ध आहेत (या दस्तऐवजात समाविष्ट नाही).'
    }
  },
  '3': {
    '1': {
      '1': 'लाभ घेणारा प्रवर्ग: सर्वसाधारण\n\n१.१ महात्मा ज्योतिबा फुले संशोधन व प्रशिक्षण संस्था (महाज्योती), नागपूर\n   इतर मागास वर्ग, विमुक्त जाती, भटक्या जमाती आणि विशेष मागास प्रवर्गातील व्यक्तींसाठी संशोधन आणि प्रशिक्षण देणारी संस्था, जी कौशल्य विकासाला प्रोत्साहन देते. महाज्योती संस्था दरवर्षी १०,००० हून अधिक विद्यार्थ्यांना प्रशिक्षण देते, ज्यात संगणक प्रशिक्षण, उद्योजकता विकास आणि स्पर्धा परीक्षा मार्गदर्शन यांचा समावेश आहे. ही संस्था ओबीसी, विमुक्त जाती आणि भटक्या जमातींना प्राधान्य देते. पुढील तपशील पान क्रमांक 54 वर उपलब्ध आहेत (या दस्तऐवजात समाविष्ट नाही).',
      '2': 'लाभ घेणारा प्रवर्ग: सर्वसाधारण\n\n१.२ महासृष्टि संशोधन अकादमी व प्रशिक्षण प्रबोधिनी (अमृत)\n   खुल्या प्रवर्गातील व्यक्तींसाठी कौशल्य विकास आणि प्रशिक्षण देणारी संस्था. या संस्थेमार्फत विविध व्यावसायिक अभ्यासक्रम राबविले जातात, ज्यामुळे व्यक्तींना रोजगाराच्या संधी उपलब्ध होतात आणि त्यांचे जीवनमान सुधारते. पुढील तपशील उपलब्ध नाहीत.'
    }
  },
  '4': {
    '1': {
      '1': 'लाभ घेणारा प्रवर्ग: इतर मागास वर्ग\n\n१.१ महाराष्ट्र राज्य इतर मागास वर्गीय वित्त आणि विकास महामंडळ\n   इतर मागास वर्गीय समुदायांसाठी आर्थिक सहाय्य प्रदान करणारी संस्था. ही संस्था मुंबई येथे मुख्यालय असून, राज्यातील ३६ जिल्हा कार्यालयांमार्फत कार्यरत आहे. संपर्क: व्यवस्थापकीय संचालक, महाराष्ट्र राज्य इतर मागास वर्गीय वित्त आणि विकास महामंडळ, आणि संबंधित जिल्ह्यांतील सामाजिक न्याय भवन येथील जिल्हा व्यवस्थापक.',
      '2': 'लाभ घेणारा प्रवर्ग: विमुक्त जाती, भटक्या जमाती\n\n१.२ वसंतराव नाईक विमुक्त जाती व भटक्या जमाती विकास महामंडळ\n   विमुक्त जाती व भटक्या जमाती समुदायांसाठी आर्थिक सहाय्य प्रदान करणारी संस्था. ही संस्था मुंबई येथे मुख्यालय असून, राज्यातील ३६ जिल्हा कार्यालयांमार्फत कार्यरत आहे. संपर्क: व्यवस्थापकीय संचालक, वसंतराव नाईक विमुक्त जाती व भटक्या जमाती विकास महामंडळ, आणि संबंधित जिल्ह्यांतील सामाजिक न्याय भवन येथील जिल्हा व्यवस्थापक.'
    }
  }
};

// Sub-sub-sub-scheme details
const subSubSubSchemeDetails = {
  '4': {
    '1': {
      '1': {
        '1': 'लाभ घेणारा प्रवर्ग: इतर मागास वर्ग\n\n१.१.१ शामराव पेजे आर्थिक विकास महामंडळ (उपकंपनी)\n   कोकण विभागातील इतर मागास प्रवर्गासाठी आर्थिक सहाय्य देणारी उपकंपनी, जी कमी व्याजदराने कर्ज पुरवते. ही उपकंपनी कोकणातील स्थानिक व्यवसाय जसे की मासेमारी, शेती आणि लघु उद्योगांना प्रोत्साहन देते.',
        '2': 'लाभ घेणारा प्रवर्ग: इतर मागास वर्ग\n\n१.१.२ जगदज्योती महात्मा बसवेश्वर आर्थिक विकास महामंडळ (उपकंपनी)\n   विशिष्ट इतर मागास प्रवर्गातील समाजासाठी आर्थिक सहाय्य देणारी उपकंपनी, जी कमी व्याजदराने कर्ज पुरवते. ही उपकंपनी विशेषतः वीरशैव-लिंगायत समाजाला लक्ष्य करते आणि त्यांच्या आर्थिक विकासासाठी कार्य करते.',
        '3': 'लाभ घेणारा प्रवर्ग: इतर मागास वर्ग\n\n१.१.३ संत रोहिदास युवा आर्थिक विकास महामंडळ (उपकंपनी)\n   विशिष्ट इतर मागास प्रवर्गातील समाजासाठी आर्थिक सहाय्य देणारी उपकंपनी, जी कमी व्याजदराने कर्ज पुरवते. ही उपकंपनी चर्मकार समाजाच्या तरुण उद्योजकांना स्वयंरोजगारासाठी प्रोत्साहन देते.',
        '4': 'लाभ घेणारा प्रवर्ग: इतर मागास वर्ग\n\n१.१.४ संत सेनाजी महाराज केशशिल्पी महामंडळ (उपकंपनी)\n   विशिष्ट इतर मागास प्रवर्गातील समाजासाठी आर्थिक सहाय्य देणारी उपकंपनी, जी कमी व्याजदराने कर्ज पुरवते. ही उपकंपनी न्हावी समाजाला लक्ष्य करते आणि त्यांच्या पारंपारिक व्यवसायाला आधुनिक स्वरूप देण्यासाठी मदत करते.',
        '5': 'लाभ घेणारा प्रवर्ग: इतर मागास वर्ग\n\n१.१.५ बीज भांडवल कर्ज योजना\n   या योजनेंतर्गत २५% महामंडळाचा सहभाग आणि ७५% बँकांचा सहभाग असतो. प्रकल्प मर्यादा ५,००,००० रुपये आहे, व्याजदर ४%, आणि परतफेडीचा कालावधी ५ वर्षे आहे. या योजनेंतर्गत लाभार्थ्यांना व्यवसाय सुरू करण्यासाठी प्रारंभिक भांडवल मिळते, ज्यामुळे त्यांना स्वयंरोजगाराची संधी उपलब्ध होते. लाभार्थ्यांना व्यवसाय प्रशिक्षण देखील दिले जाते.',
        '6': 'लाभ घेणारा प्रवर्ग: इतर मागास वर्ग\n\n१.१.६ रु.1,00,000/- टेट कर्ज योजना\n   १,००,००० रुपये पर्यंत थेट कर्ज उपलब्ध आहे. लाभार्थ्यांचा सहभाग शून्य आहे. नियमित परतफेड करणाऱ्या लाभार्थ्यांना व्याज आकारले जाणार नाही (४८ मासिक हप्त्यांमध्ये २,०८५ रुपये); अन्यथा ४% व्याज आकारले जाते. या योजनेंतर्गत कर्जाची परतफेड ४ वर्षांत करावी लागते, आणि कर्ज मंजुरीसाठी ऑनलाइन अर्ज प्रक्रिया उपलब्ध आहे, ज्यामुळे प्रक्रिया जलद आणि पारदर्शी होते.',
        '7': 'लाभ घेणारा प्रवर्ग: इतर मागास वर्ग\n\n१.१.७ वैयक्तिक कर्ज व्याज परतावा योजना\n   १०,००,००० रुपये पर्यंतच्या कर्जावर १२% व्याजदरापर्यंत व्याज परतावा मिळतो, जो लाभार्थ्यांच्या बँक खात्यात दरमहा PFMS मार्फत जमा केला जातो, जर नियमित परतफेड केली तर. या योजनेंतर्गत व्याज परतावा थेट लाभार्थ्यांच्या आधार लिंक केलेल्या बँक खात्यात जमा होतो, ज्यामुळे त्यांना आर्थिक भार कमी होतो.',
        '8': 'लाभ घेणारा प्रवर्ग: इतर मागास वर्ग\n\n१.१.८ गट कर्ज व्याज परतावा योजना\n   १०,००,००० ते ४०,००,००० रुपये पर्यंतच्या गट कर्जावर १२% व्याजदरापर्यंत किंवा १५,००,००० रुपये पर्यंत व्याज परतावा मिळतो, जो दरमहा गटाच्या बँक खात्यात PFMS मार्फत जमा केला जातो, जर नियमित परतफेड केली तर. गट कर्ज योजनेंतर्गत ५ ते १० व्यक्तींचा समूह तयार करून कर्ज घेता येते, आणि गटातील सर्व सदस्यांना प्रशिक्षण आणि मार्गदर्शन दिले जाते.'
      },
      '2': {
        '1': 'लाभ घेणारा प्रवर्ग: विमुक्त जाती, भटक्या जमाती\n\n१.२.१ पैलवान के. मारुती चर्हाण-वडार आर्थिक विकास महामंडळ (उपकंपनी)\n   वडार समाजाच्या सामाजिक व आर्थिक उन्नतीसाठी स्थापन केलेली उपकंपनी, जी कमी व्याजदराने कर्ज पुरवते आणि स्वयंरोजगाराला प्रोत्साहन देते. वडार समाजातील व्यक्तींसाठी ही उपकंपनी पारंपारिक व्यवसाय जसे की दगड खणणे, बांधकाम यासह आधुनिक व्यवसाय जसे की लघु उद्योगांना प्रोत्साहन देते. या उपकंपनीमार्फत वडार समाजातील तरुणांना कौशल्य प्रशिक्षण आणि आर्थिक सहाय्य मिळते.',
        '2': 'लाभ घेणारा प्रवर्ग: विमुक्त जाती, भटक्या जमाती\n\n१.२.२ राजे उमाजी नाईक जातीय विकास महामंडळ (उपकंपनी)\n   रामोशी-बेराड समाजाच्या सामाजिक व आर्थिक उन्नतीसाठी स्थापन केलेली उपकंपनी, जी कमी व्याजदराने कर्ज पुरवते आणि स्वयंरोजगाराला प्रोत्साहन देते. रामोशी-बेराड समाजातील व्यक्तींसाठी ही उपकंपनी शेती, पशुपालन आणि लघु उद्योगांसाठी कर्ज उपलब्ध करते, ज्यामुळे त्यांचे जीवनमान सुधारते. या उपकंपनीमार्फत रामोशी-बेराड समाजातील व्यक्तींना आर्थिक स्वावलंबनासाठी मार्गदर्शन आणि प्रशिक्षण दिले जाते.'
      }
    }
  }
};

// Sub-sub-sub-sub-scheme details
const subSubSubSubSchemeDetails = {
  '4': {
    '1': {
      '2': {
        '1': {
          '1': 'लाभ घेणारा प्रवर्ग: विमुक्त जाती, भटक्या जमाती\n\n१.२.१.१ २५% बीज भांडवल योजना\n   या योजनेंतर्गत २५% महामंडळाचा सहभाग आणि ७५% बँकांचा सहभाग असतो. प्रकल्प मर्यादा ५,००,००० रुपये आहे, व्याजदर ४%, आणि परतफेडीचा कालावधी ५ वर्षे आहे. या योजनेंतर्गत लाभार्थ्यांना व्यवसाय सुरू करण्यासाठी प्रारंभिक भांडवल मिळते, ज्यामुळे त्यांना स्वयंरोजगाराची संधी उपलब्ध होते. लाभार्थ्यांना व्यवसाय प्रशिक्षण देखील दिले जाते.',
          '2': 'लाभ घेणारा प्रवर्ग: विमुक्त जाती, भटक्या जमाती\n\n१.२.१.२ रु. 1.00 लक्षपर्यंतची धेट कर्ज योजना\n   १,००,००० रुपये पर्यंत थेट कर्ज उपलब्ध आहे. लाभार्थ्यांचा सहभाग शून्य आहे. नियमित परतफेड करणाऱ्या लाभार्थ्यांना व्याज आकारले जाणार नाही (४८ मासिक हप्त्यांमध्ये २,०८५ रुपये); अन्यथा ४% व्याज आकारले जाते. या योजनेंतर्गत कर्जाची परतफेड ४ वर्षांत करावी लागते, आणि कर्ज मंजुरीसाठी ऑनलाइन अर्ज प्रक्रिया उपलब्ध आहे, ज्यामुळे प्रक्रिया जलद आणि पारदर्शी होते.',
          '3': 'लाभ घेणारा प्रवर्ग: विमुक्त जाती, भटक्या जमाती\n\n१.२.१.३ वैयक्तिक कर्ज व्याज परतावा योजना\n   १०,००,००० रुपये पर्यंतच्या कर्जावर १२% व्याजदरापर्यंत व्याज परतावा मिळतो, जो लाभार्थ्यांच्या बँक खात्यात दरमहा PFMS मार्फत जमा केला जातो, जर नियमित परतफेड केली तर. या योजनेंतर्गत व्याज परतावा थेट लाभार्थ्यांच्या आधार लिंक केलेल्या बँक खात्यात जमा होतो, ज्यामुळे त्यांना आर्थिक भार कमी होतो.',
          '4': 'लाभ घेणारा प्रवर्ग: विमुक्त जाती, भटक्या जमाती\n\n१.२.१.४ गट कर्ज व्याज परतावा योजना\n   १०,००,००० ते ४०,००,००० रुपये पर्यंतच्या गट कर्जावर १२% व्याजदरापर्यंत किंवा १५,००,००० रुपये पर्यंत व्याज परतावा मिळतो, जो दरमहा गटाच्या बँक खात्यात PFMS मार्फत जमा केला जातो, जर नियमित परतफेड केली तर. गट कर्ज योजनेंतर्गत ५ ते १० व्यक्तींचा समूह तयार करून कर्ज घेता येते, आणि गटातील सर्व सदस्यांना प्रशिक्षण आणि मार्गदर्शन दिले जाते.'
        },
        '2': {
          '1': 'लाभ घेणारा प्रवर्ग: विमुक्त जाती, भटक्या जमाती\n\n१.२.२.१ २५% बीज भांडवल योजना\n   या योजनेंतर्गत २५% महामंडळाचा सहभाग आणि ७५% बँकांचा सहभाग असतो. प्रकल्प मर्यादा ५,००,००० रुपये आहे, व्याजदर ४%, आणि परतफेडीचा कालावधी ५ वर्षे आहे. या योजनेंतर्गत लाभार्थ्यांना व्यवसाय सुरू करण्यासाठी प्रारंभिक भांडवल मिळते, ज्यामुळे त्यांना स्वयंरोजगाराची संधी उपलब्ध होते. लाभार्थ्यांना व्यवसाय प्रशिक्षण देखील दिले जाते.',
          '2': 'लाभ घेणारा प्रवर्ग: विमुक्त जाती, भटक्या जमाती\n\n१.२.२.२ रु. 1.00 लक्षपर्यंतची धेट कर्ज योजना\n   १,००,००० रुपये पर्यंत थेट कर्ज उपलब्ध आहे. लाभार्थ्यांचा सहभाग शून्य आहे. नियमित परतफेड करणाऱ्या लाभार्थ्यांना व्याज आकारले जाणार नाही (४८ मासिक हप्त्यांमध्ये २,०८५ रुपये); अन्यथा ४% व्याज आकारले जाते. या योजनेंतर्गत कर्जाची परतफेड ४ वर्षांत करावी लागते, आणि कर्ज मंजुरीसाठी ऑनलाइन अर्ज प्रक्रिया उपलब्ध आहे, ज्यामुळे प्रक्रिया जलद आणि पारदर्शी होते.',
          '3': 'लाभ घेणारा प्रवर्ग: विमुक्त जाती, भटक्या जमाती\n\n१.२.२.३ वैयक्तिक कर्ज व्याज परतावा योजना\n   १०,००,००० रुपये पर्यंतच्या कर्जावर १२% व्याजदरापर्यंत व्याज परतावा मिळतो, जो लाभार्थ्यांच्या बँक खात्यात दरमहा PFMS मार्फत जमा केला जातो, जर नियमित परतफेड केली तर. या योजनेंतर्गत व्याज परतावा थेट लाभार्थ्यांच्या आधार लिंक केलेल्या बँक खात्यात जमा होतो, ज्यामुळे त्यांना आर्थिक भार कमी होतो.',
          '4': 'लाभ घेणारा प्रवर्ग: विमुक्त जाती, भटक्या जमाती\n\n१.२.२.४ गट कर्ज व्याज परतावा योजना\n   १०,००,००० ते ४०,००,००० रुपये पर्यंतच्या गट कर्जावर १२% व्याजदरापर्यंत किंवा १५,००,००० रुपये पर्यंत व्याज परतावा मिळतो, जो दरमहा गटाच्या बँक खात्यात PFMS मार्फत जमा केला जातो, जर नियमित परतफेड केली तर. गट कर्ज योजनेंतर्गत ५ ते १० व्यक्तींचा समूह तयार करून कर्ज घेता येते, आणि गटातील सर्व सदस्यांना प्रशिक्षण आणि मार्गदर्शन दिले जाते.',
          '5': 'लाभ घेणारा प्रवर्ग: विमुक्त जाती, भटक्या जमाती\n\n१.२.२.५ पात्र शेतकरी उत्पादक गटांना कर्ज\n   पात्र शेतकरी उत्पादक गटांना १०,००,००० रुपये पर्यंत व्याजमुक्त कर्ज उपलब्ध आहे. या योजनेंतर्गत शेतकरी उत्पादक गटांना त्यांच्या शेती उत्पादन आणि विपणनासाठी आर्थिक सहाय्य मिळते, ज्यामुळे त्यांचे उत्पन्न वाढते.'
        }
      }
    }
  }
};

// Mapping of main scheme, sub-scheme, sub-sub-scheme, etc., to image URLs
const schemeImages = {
  '1': {
    '1': [
      'URL_TO_IMAGE1', // Replace with actual URL for image1.png
      'URL_TO_IMAGE2'  // Replace with actual URL for image2.png
    ],
    '2': null,
    '3': null
  },
  '2': {
    '0': null
  },
  '3': {
    '1': null
  },
  '4': {
    '1': null
  },
  '5': {
    '0': null
  }
};

// Helper to send WhatsApp text messages via Twilio with message splitting
async function sendMessage(to, body) {
  const MAX_LENGTH = 1600; // WhatsApp message character limit
  try {
    if (body.length <= MAX_LENGTH) {
      await client.messages.create({
        from: twilioWhatsAppNumber,
        to: to,
        body: body
      });
      console.log(`Text message sent to ${to}`);
    } else {
      const lines = body.split('\n');
      let currentChunk = '';
      const chunks = [];

      for (const line of lines) {
        const lineWithNewline = line + '\n';
        if (currentChunk.length + lineWithNewline.length <= MAX_LENGTH) {
          currentChunk += lineWithNewline;
        } else {
          if (currentChunk) {
            chunks.push(currentChunk.trimEnd());
          }
          currentChunk = lineWithNewline;
        }
      }

      if (currentChunk) {
        chunks.push(currentChunk.trimEnd());
      }

      for (const chunk of chunks) {
        await client.messages.create({
          from: twilioWhatsAppNumber,
          to: to,
          body: chunk
        });
        console.log(`Text message chunk sent to ${to}`);
        await new Promise(resolve => setTimeout(resolve, 1000));
      }
    }
  } catch (error) {
    console.error('Error sending text message:', error.message);
  }
}

// Helper to send WhatsApp image messages via Twilio
async function sendImage(to, imageUrl, caption = '') {
  try {
    await client.messages.create({
      from: twilioWhatsAppNumber,
      to: to,
      mediaUrl: [imageUrl],
      body: caption
    });
    console.log(`Image message sent to ${to}`);
  } catch (error) {
    console.error('Error sending image message:', error.message);
  }
}

// List of main schemes
async function sendMainSchemesList(to) {
  const schemes = [
    '0. मेन्यू परत जा',
    '1. शैक्षणिक योजना',
    '2. पायाभूत सुविधा संबंधित योजना',
    '3. कौशल्य विकासाच्या योजना',
    '4. अर्थसहाय्याच्या योजना',
    '5. इतर योजना'
  ].join('\n');

  const message = `नमस्कार! विभागा अंतर्गत राबविल्या जाणाऱ्या योजनांमध्ये आपले स्वागत आहे.\nकृपया एक योजना निवडा:\n\n${schemes}\n\nक्रमांकासह उत्तर द्या (उदा., 1). मेन्यूवर परत जाण्यासाठी 0 सह उत्तर द्या.`;
  await sendMessage(to, message);
}

// List of sub-schemes for a selected main scheme
async function sendSubSchemesList(to, mainScheme) {
  const subSchemesList = subSchemes[mainScheme];
  if (subSchemesList.length === 0) {
    const details = subSchemeDetails[mainScheme]['0'];
    const imageUrl = schemeImages[mainScheme]['0'];
    if (imageUrl) {
      await sendImage(to, imageUrl, `तपशील:`);
    }
    await sendMessage(to, `${details}\n\nमागील मेन्यूवर परत जाण्यासाठी 0 सह उत्तर द्या.`);
  } else {
    const message = `कृपया खालील योजनांमधून एक निवडा:\n\n0. मागील मेन्यू परत जा\n${subSchemesList.join('\n')}\n\nक्रमांकासह उत्तर द्या (उदा., 1). मागील मेन्यूवर परत जाण्यासाठी 0 सह उत्तर द्या.`;
    await sendMessage(to, message);
  }
}

// List of sub-sub-schemes for a selected sub-scheme
async function sendSubSubSchemesList(to, mainScheme, subScheme) {
  const subSubSchemesList = subSubSchemes[mainScheme]?.[subScheme] || [];
  if (subSubSchemesList.length === 0) {
    const details = subSchemeDetails[mainScheme][subScheme];
    const imageUrl = schemeImages[mainScheme][subScheme];
    if (imageUrl) {
      await sendImage(to, imageUrl, `तपशील:`);
    }
    await sendMessage(to, `${details}\n\nमागील मेन्यूवर परत जाण्यासाठी 0 सह उत्तर द्या.`);
  } else {
    const message = `कृपया खालील योजनांमधून एक निवडा:\n\n0. मागील मेन्यू परत जा\n${subSubSchemesList.join('\n')}\n\nक्रमांकासह उत्तर द्या (उदा., 1). मागील मेन्यूवर परत जाण्यासाठी 0 सह उत्तर द्या.`;
    await sendMessage(to, message);
  }
}

// List of sub-sub-sub-schemes for a selected sub-sub-scheme
async function sendSubSubSubSchemesList(to, mainScheme, subScheme, subSubScheme) {
  const subSubSubSchemesList = subSubSubSchemes[mainScheme]?.[subScheme]?.[subSubScheme] || [];
  if (subSubSubSchemesList.length === 0) {
    const details = subSubSchemeDetails[mainScheme][subScheme][subSubScheme];
    const imageUrl = schemeImages[mainScheme][subScheme];
    if (imageUrl) {
      await sendImage(to, imageUrl, `तपशील:`);
    }
    await sendMessage(to, `${details}\n\nमागील मेन्यूवर परत जाण्यासाठी 0 सह उत्तर द्या.`);
  } else {
    const message = `कृपया खालील योजनांमधून एक निवडा:\n\n0. मागील मेन्यू परत जा\n${subSubSubSchemesList.join('\n')}\n\nक्रमांकासह उत्तर द्या (उदा., 1). मागील मेन्यूवर परत जाण्यासाठी 0 सह उत्तर द्या.`;
    await sendMessage(to, message);
  }
}

// List of sub-sub-sub-sub-schemes for a selected sub-sub-sub-scheme
async function sendSubSubSubSubSchemesList(to, mainScheme, subScheme, subSubScheme, subSubSubScheme) {
  const subSubSubSubSchemesList = subSubSubSubSchemes[mainScheme]?.[subScheme]?.[subSubScheme]?.[subSubSubScheme] || [];
  if (subSubSubSubSchemesList.length === 0) {
    const details = subSubSubSchemeDetails[mainScheme][subScheme][subSubScheme][subSubSubScheme];
    const imageUrl = schemeImages[mainScheme][subScheme];
    if (imageUrl) {
      await sendImage(to, imageUrl, `तपशील:`);
    }
    await sendMessage(to, `${details}\n\nमागील मेन्यूवर परत जाण्यासाठी 0 सह उत्तर द्या.`);
  } else {
    const message = `कृपया खालील योजनांमधून एक निवडा:\n\n0. मागील मेन्यू परत जा\n${subSubSubSubSchemesList.join('\n')}\n\nक्रमांकासह उत्तर द्या (उदा., 1). मागील मेन्यूवर परत जाण्यासाठी 0 सह उत्तर द्या.`;
    await sendMessage(to, message);
  }
}

// Webhook to handle incoming messages from Twilio
app.post('/webhook', async (req, res) => {
  const from = req.body.From;
  const messageBody = req.body.Body;

  if (!userState[from]) {
    userState[from] = { step: 'mainSchemes' };
    await sendMainSchemesList(from);
  } else if (userState[from].step === 'mainSchemes') {
    const choice = messageBody;
    if (/^\d+$/.test(choice)) {
      if (choice === '0') {
        userState[from] = { step: 'mainSchemes' };
        await sendMainSchemesList(from);
      } else if (choice >= 1 && choice <= 5) {
        userState[from] = { step: 'subSchemes', mainScheme: choice };
        await sendSubSchemesList(from, choice);
      } else {
        await sendMessage(from, 'कृपया 0 ते 5 मधील एक वैध क्रमांक निवडा. मेन्यूवर परत जाण्यासाठी 0 सह उत्तर द्या.');
      }
    } else {
      await sendMessage(from, 'कृपया 0 ते 5 मधील एक वैध क्रमांक निवडा. मेन्यूवर परत जाण्यासाठी 0 सह उत्तर द्या.');
    }
  } else if (userState[from].step === 'subSchemes') {
    const mainScheme = userState[from].mainScheme;
    const choice = messageBody;
    const maxSubScheme = subSchemes[mainScheme].length;

    if (/^\d+$/.test(choice)) {
      if (choice === '0') {
        userState[from] = { step: 'mainSchemes' };
        await sendMainSchemesList(from);
      } else if (choice >= 1 && choice <= maxSubScheme) {
        userState[from] = { step: 'subSubSchemes', mainScheme, subScheme: choice };
        await sendSubSubSchemesList(from, mainScheme, choice);
      } else {
        await sendMessage(from, `कृपया 0 ते ${maxSubScheme} मधील एक वैध क्रमांक निवडा. मागील मेन्यूवर परत जाण्यासाठी 0 सह उत्तर द्या.`);
      }
    } else {
      await sendMessage(from, `कृपया 0 ते ${maxSubScheme} मधील एक वैध क्रमांक निवडा. मागील मेन्यूवर परत जाण्यासाठी 0 सह उत्तर द्या.`);
    }
  } else if (userState[from].step === 'subSubSchemes') {
    const mainScheme = userState[from].mainScheme;
    const subScheme = userState[from].subScheme;
    const choice = messageBody;
    const maxSubSubScheme = subSubSchemes[mainScheme]?.[subScheme]?.length || 0;

    if (/^\d+$/.test(choice)) {
      if (choice === '0') {
        userState[from] = { step: 'mainSchemes' };
        await sendMainSchemesList(from);
      } else if (choice >= 1 && choice <= maxSubSubScheme) {
        userState[from] = { step: 'subSubSubSchemes', mainScheme, subScheme, subSubScheme: choice };
        await sendSubSubSubSchemesList(from, mainScheme, subScheme, choice);
      } else {
        await sendMessage(from, `कृपया 0 ते ${maxSubSubScheme} मधील एक वैध क्रमांक निवडा. मागील मेन्यूवर परत जाण्यासाठी 0 सह उत्तर द्या.`);
      }
    } else {
      await sendMessage(from, `कृपया 0 ते ${maxSubSubScheme} मधील एक वैध क्रमांक निवडा. मागील मेन्यूवर परत जाण्यासाठी 0 सह उत्तर द्या.`);
    }
  } else if (userState[from].step === 'subSubSubSchemes') {
    const mainScheme = userState[from].mainScheme;
    const subScheme = userState[from].subScheme;
    const subSubScheme = userState[from].subSubScheme;
    const choice = messageBody;
    const maxSubSubSubScheme = subSubSubSchemes[mainScheme]?.[subScheme]?.[subSubScheme]?.length || 0;

    if (/^\d+$/.test(choice)) {
      if (choice === '0') {
        userState[from] = { step: 'mainSchemes' };
        await sendMainSchemesList(from);
      } else if (choice >= 1 && choice <= maxSubSubSubScheme) {
        userState[from] = { step: 'subSubSubSubSchemes', mainScheme, subScheme, subSubScheme, subSubSubScheme: choice };
        await sendSubSubSubSubSchemesList(from, mainScheme, subScheme, subSubScheme, choice);
      } else {
        await sendMessage(from, `कृपया 0 ते ${maxSubSubSubScheme} मधील एक वैध क्रमांक निवडा. मागील मेन्यूवर परत जाण्यासाठी 0 सह उत्तर द्या.`);
      }
    } else {
      await sendMessage(from, `कृपया 0 ते ${maxSubSubSubScheme} मधील एक वैध क्रमांक निवडा. मागील मेन्यूवर परत जाण्यासाठी 0 सह उत्तर द्या.`);
    }
  } else if (userState[from].step === 'subSubSubSubSchemes') {
    const mainScheme = userState[from].mainScheme;
    const subScheme = userState[from].subScheme;
    const subSubScheme = userState[from].subSubScheme;
    const subSubSubScheme = userState[from].subSubSubScheme;
    const choice = messageBody;
    const maxSubSubSubSubScheme = subSubSubSubSchemes[mainScheme]?.[subScheme]?.[subSubScheme]?.[subSubSubScheme]?.length || 0;

    if (/^\d+$/.test(choice)) {
      if (choice === '0') {
        userState[from] = { step: 'mainSchemes' };
        await sendMainSchemesList(from);
      } else if (choice >= 1 && choice <= maxSubSubSubSubScheme) {
        const details = subSubSubSubSchemeDetails[mainScheme][subScheme][subSubScheme][subSubSubScheme][choice];
        const imageUrl = schemeImages[mainScheme][subScheme];
        if (imageUrl) {
          await sendImage(from, imageUrl, `तपशील:`);
        }
        await sendMessage(from, `${details}\n\nमागील मेन्यूवर परत जाण्यासाठी 0 सह उत्तर द्या.`);
      } else {
        await sendMessage(from, `कृपया 0 ते ${maxSubSubSubSubScheme} मधील एक वैध क्रमांक निवडा. मागील मेन्यूवर परत जाण्यासाठी 0 सह उत्तर द्या.`);
      }
    } else {
      await sendMessage(from, `कृपया 0 ते ${maxSubSubSubSubScheme} मधील एक वैध क्रमांक निवडा. मागील मेन्यूवर परत जाण्यासाठी 0 सह उत्तर द्या.`);
    }
  }

  res.status(200).send('OK');
});

// Basic route for testing
app.get('/', (req, res) => {
  res.send('व्हॉट्सअॅप चॅटबॉट सुरू आहे!');
});

app.listen(3000, () => console.log('Server running on port 3000'));